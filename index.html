<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ìœ¨ ê³„ì‚°ê¸°</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’±</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e88e5 0%, #0d47a1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            transition: background 0.5s ease;
        }

        body.hana-theme {
            background: linear-gradient(135deg, #008485 0%, #00A896 100%);
        }

        .calculator {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 20px;
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            display: none;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            padding: 10px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #666;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: -2px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab-logo {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        .tab-button:hover {
            color: #1e88e5;
        }

        .tab-button.active {
            color: #1e88e5;
            border-bottom-color: #1e88e5;
        }

        body.hana-theme .tab-button:hover {
            color: #008485;
        }

        body.hana-theme .tab-button.active {
            color: #008485;
            border-bottom-color: #008485;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        iframe {
            width: 100%;
            border: none;
            height: 85vh;
        }

        /* í”Œë¡œíŒ… ê³„ì‚°ê¸° ë²„íŠ¼ */
        .floating-calc-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 12px 24px;
            border-radius: 30px;
            background: linear-gradient(135deg, #ff9500 0%, #ff6b00 100%);
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .floating-calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.6);
        }

        /* ê³„ì‚°ê¸° ìœ„ì ¯ */
        .calculator-widget {
            position: fixed;
            top: 50%;
            right: 2%;
            transform: translateY(-50%);
            width: 267px;
            height: 423px;
            border-radius: 11px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
            overflow: hidden;
            background: transparent;
        }

        .calculator-widget.active {
            display: block;
        }

        .calculator-widget iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 11px;
            pointer-events: auto;
        }

        /* ë“œë˜ê·¸ í•¸ë“¤ */
        .drag-handle {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            cursor: move;
            z-index: 1001;
            background: transparent;
        }

        /* ìƒì¼ íŒì—… ìŠ¤íƒ€ì¼ */
        .birthday-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            max-width: 230px;
            animation: slideIn 0.5s ease-out;
            display: none;
        }

        .birthday-popup.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .birthday-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .birthday-popup-title {
            font-size: 18px;
            font-weight: bold;
            color: #ff6b6b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .birthday-popup-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .birthday-popup-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        .birthday-popup-content {
            text-align: center;
        }

        .birthday-popup-emoji {
            width: 140px;
            height: 140px;
            margin: 15px auto;
            display: block;
        }

        .birthday-popup-text {
            font-size: 15px;
            color: #333;
            line-height: 1.6;
            margin-top: 10px;
        }

    </style>
</head>
<body>
    <div class="calculator">
        <h1>í™˜ìœ¨ ê³„ì‚°ê¸°</h1>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('unipass')">
                <img src="uni-logo.png" alt="ê´€ì„¸ì²­" class="tab-logo">
                ê´€ì„¸ì²­ (UNIPASS)
            </button>
            <button class="tab-button" onclick="switchTab('hana')">
                <img src="hana-logo.png" alt="í•˜ë‚˜ì€í–‰" class="tab-logo">
                í•˜ë‚˜ì€í–‰
            </button>
        </div>

        <div id="unipass-tab" class="tab-content active">
            <iframe src="unipass/index.html" id="unipass-frame"></iframe>
        </div>

        <div id="hana-tab" class="tab-content">
            <iframe src="hana/index.html" id="hana-frame"></iframe>
        </div>
    </div>

    <!-- í”Œë¡œíŒ… ê³„ì‚°ê¸° ë²„íŠ¼ -->
    <button class="floating-calc-button" onclick="openCalculator()">ğŸ”¢ ê³„ì‚°ê¸° (key : â‚©)</button>

    <!-- ê³„ì‚°ê¸° ìœ„ì ¯ -->
    <div id="calculator-widget" class="calculator-widget">
        <div class="drag-handle" id="drag-handle"></div>
        <iframe src="calculator/index.html" id="calculator-frame"></iframe>
    </div>

    <!-- ìƒì¼ íŒì—… -->
    <div id="birthday-popup" class="birthday-popup">
        <div class="birthday-popup-header">
            <div class="birthday-popup-title">ğŸ’¡ TIP</div>
            <button class="birthday-popup-close" onclick="closeBirthdayPopup()">Ã—</button>
        </div>
        <div class="birthday-popup-content">
            <img src="emoji.gif" alt="ìƒì¼ ì¶•í•˜" class="birthday-popup-emoji">
            <p class="birthday-popup-text">11ì›” 17ì¼ì€ ê¹€ìŠ¬ë‹˜ì˜ ìƒì¼ì´ë¼ëŠ” ì  ëª¨ë‘ ì•Œê³  ê³„ì…¨ë‚˜ìš”?</p>
        </div>
    </div>

    <script>
        function switchTab(tab) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ì„ íƒëœ íƒ­ í™œì„±í™” ë° í…Œë§ˆ ë³€ê²½
            if (tab === 'hana') {
                document.querySelector('[onclick="switchTab(\'hana\')"]').classList.add('active');
                document.getElementById('hana-tab').classList.add('active');
                document.body.classList.add('hana-theme');
            } else {
                document.querySelector('[onclick="switchTab(\'unipass\')"]').classList.add('active');
                document.getElementById('unipass-tab').classList.add('active');
                document.body.classList.remove('hana-theme');
            }

            // localStorageì— í˜„ì¬ íƒ­ ì €ì¥
            localStorage.setItem('activeTab', tab);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë§ˆì§€ë§‰ ì„ íƒí•œ íƒ­ ë³µì›
        window.addEventListener('DOMContentLoaded', () => {
            const lastTab = localStorage.getItem('activeTab') || 'unipass';
            switchTab(lastTab);
        });

        // ê³„ì‚°ê¸° ìœ„ì ¯ ì—´ê¸°/ë‹«ê¸°
        function openCalculator() {
            const widget = document.getElementById('calculator-widget');

            if (widget.classList.contains('active')) {
                widget.classList.remove('active');
            } else {
                widget.classList.add('active');

                // ì €ì¥ëœ ìœ„ì¹˜ê°€ ìˆëŠ”ì§€ í™•ì¸
                const savedPosition = localStorage.getItem('calculator-position');
                let useDefaultPosition = true;

                if (savedPosition) {
                    try {
                        const position = JSON.parse(savedPosition);
                        const left = parseInt(position.left);
                        const top = parseInt(position.top);

                        // í™”ë©´ í¬ê¸°
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        const widgetWidth = 267;
                        const widgetHeight = 423;

                        // ì €ì¥ëœ ìœ„ì¹˜ê°€ í™”ë©´ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
                        const isInViewport =
                            left >= 0 &&
                            top >= 0 &&
                            left + widgetWidth <= viewportWidth &&
                            top + widgetHeight <= viewportHeight;

                        if (isInViewport) {
                            // í™”ë©´ ë‚´ì— ìˆìœ¼ë©´ ì €ì¥ëœ ìœ„ì¹˜ ë³µì›
                            widget.style.left = position.left;
                            widget.style.top = position.top;
                            widget.style.right = 'auto';
                            widget.style.transform = 'none';
                            useDefaultPosition = false;
                        }
                    } catch (e) {
                        // JSON íŒŒì‹± ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ìœ„ì¹˜ ì‚¬ìš©
                        console.error('Failed to parse calculator position:', e);
                    }
                }

                if (useDefaultPosition) {
                    // ê¸°ë³¸ ìœ„ì¹˜ (ìš°ì¸¡ 2%)
                    widget.style.transform = 'translateY(-50%)';
                    widget.style.top = '50%';
                    widget.style.right = '2%';
                    widget.style.left = 'auto';
                }

                widget.style.width = '267px';
                widget.style.height = '423px';

                // iframeì— í¬ì»¤ìŠ¤ ì£¼ê¸° (í‚¤ë³´ë“œ ì…ë ¥ ë°”ë¡œ ê°€ëŠ¥í•˜ë„ë¡)
                setTimeout(() => {
                    const iframe = document.getElementById('calculator-frame');
                    if (iframe && iframe.contentWindow) {
                        iframe.contentWindow.focus();
                    }
                }, 100);
            }
        }

        // ë“œë˜ê·¸ ê¸°ëŠ¥
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        const widget = document.getElementById('calculator-widget');
        const dragHandle = document.getElementById('drag-handle');

        dragHandle.addEventListener('mousedown', dragStart);
        dragHandle.addEventListener('touchstart', dragStart);

        function dragStart(e) {
            e.preventDefault();

            // í˜„ì¬ ìœ„ì ¯ì˜ ì‹¤ì œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
            const rect = widget.getBoundingClientRect();

            // ë§ˆìš°ìŠ¤ í´ë¦­ ìœ„ì¹˜ì™€ ìœ„ì ¯ ì¢Œìƒë‹¨ ê°„ì˜ ì˜¤í”„ì…‹ ê³„ì‚°
            if (e.type === 'touchstart') {
                dragOffsetX = e.touches[0].clientX - rect.left;
                dragOffsetY = e.touches[0].clientY - rect.top;
            } else {
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
            }

            // right/transform ì œê±°í•˜ê³  left/topìœ¼ë¡œ ì „í™˜
            widget.style.right = 'auto';
            widget.style.transform = 'none';
            widget.style.left = rect.left + 'px';
            widget.style.top = rect.top + 'px';

            isDragging = true;

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', dragEnd);
        }

        function drag(e) {
            if (!isDragging) return;

            e.preventDefault();

            let clientX, clientY;
            if (e.type === 'touchmove') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            // ìƒˆ ìœ„ì¹˜ ê³„ì‚° (ë§ˆìš°ìŠ¤ ìœ„ì¹˜ - ì˜¤í”„ì…‹)
            let newLeft = clientX - dragOffsetX;
            let newTop = clientY - dragOffsetY;

            // ê²½ê³„ ì²´í¬
            const widgetWidth = widget.offsetWidth;
            const widgetHeight = widget.offsetHeight;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            newLeft = Math.max(0, Math.min(viewportWidth - widgetWidth, newLeft));
            newTop = Math.max(0, Math.min(viewportHeight - widgetHeight, newTop));

            widget.style.left = newLeft + 'px';
            widget.style.top = newTop + 'px';
        }

        function dragEnd(e) {
            if (!isDragging) return;

            isDragging = false;

            // ë“œë˜ê·¸ ì¢…ë£Œ ì‹œ ìœ„ì¹˜ ì €ì¥
            localStorage.setItem('calculator-position', JSON.stringify({
                left: widget.style.left,
                top: widget.style.top
            }));

            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', dragEnd);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', dragEnd);
        }

        // ìƒì¼ íŒì—… ê´€ë ¨ í•¨ìˆ˜
        let isBirthdayPopupClosed = false; // í˜„ì¬ ì„¸ì…˜ì—ì„œë§Œ ìœ ì§€

        function checkBirthdayPopup() {
            const now = new Date();
            const month = now.getMonth() + 1; // 0-11ì´ë¯€ë¡œ +1
            const date = now.getDate();

            // 11ì›” 10ì¼ë¶€í„° 11ì›” 17ì¼ê¹Œì§€ ì²´í¬
            const isInDateRange = (month === 11 && date >= 10 && date <= 17);

            // ë‚ ì§œ ë²”ìœ„ì— ìˆê³ , í˜„ì¬ ì„¸ì…˜ì—ì„œ ì•„ì§ ë‹«ì§€ ì•Šì•˜ë‹¤ë©´ íŒì—… í‘œì‹œ
            if (isInDateRange && !isBirthdayPopupClosed) {
                setTimeout(() => {
                    document.getElementById('birthday-popup').classList.add('show');
                }, 500); // í˜ì´ì§€ ë¡œë“œ í›„ 0.5ì´ˆ ë’¤ì— íŒì—… í‘œì‹œ
            }
        }

        function closeBirthdayPopup() {
            const popup = document.getElementById('birthday-popup');
            popup.classList.remove('show');

            // í˜„ì¬ ì„¸ì…˜ì—ì„œë§Œ ë‹«íŒ ìƒíƒœ ìœ ì§€ (ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë‹¤ì‹œ ë‚˜íƒ€ë‚¨)
            isBirthdayPopupClosed = true;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒì¼ íŒì—… ì²´í¬
        window.addEventListener('DOMContentLoaded', () => {
            checkBirthdayPopup();
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤: ë°±ìŠ¬ë˜ì‹œ(\) í‚¤ë¡œ ê³„ì‚°ê¸° ì—´ê¸°
        document.addEventListener('keydown', (e) => {
            if (e.key === '\\') {
                e.preventDefault();
                openCalculator();
            }
        });

        // ê³„ì‚°ê¸° iframeìœ¼ë¡œë¶€í„° ë©”ì‹œì§€ ë°›ê¸°
        window.addEventListener('message', (e) => {
            if (e.data === 'toggleCalculator') {
                openCalculator();
            }
        });
    </script>
</body>
</html>
